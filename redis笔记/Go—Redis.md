# Goâ€”Redis

## ä¸€ã€RedisåŸºæœ¬ä»‹ç»ã€å®‰è£…åŠåŸç†

### 1. åŸºæœ¬ä»‹ç»ï¼š

â‘ Redisæ˜¯NoSQLæ•°æ®åº“ï¼ˆéå…³ç³»å‹æ•°æ®åº“ï¼‰ğŸ’¨[å®˜ç½‘](https//redis.cn)

â‘¡Redis(**Remote Dlctionary Server**),æ„å³`è¿œç¨‹å­—å…¸æœåŠ¡å™¨`ï¼Œå•æœºèƒ½è¾¾åˆ°15w qpsï¼Œé€‚åˆåšç¼“å­˜ï¼Œä¹Ÿå¯ä»¥æŒä¹…åŒ–ã€‚

â‘¢Redisæ˜¯é«˜æ€§èƒ½çš„ï¼ˆkey/value)åˆ†å¸ƒå¼å†…å­˜æ•°æ®åº“ï¼ŒåŸºäºå†…å­˜è¿è¡Œå¹¶æ”¯æŒæŒä¹…åŒ–çš„NoSQLæ•°æ®åº“ï¼Œä¹Ÿæˆä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨

### 2. Rediså®‰è£…

ç›´æ¥è¿›å…¥å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œè‡³å……è¶³ç£ç›˜ä½ç½®å¤„ï¼Œç„¶åå³å¯ä½¿ç”¨Redisäº†ã€‚

ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿å…ˆå¯ä»¥ä¸ºRedisåŒ…é…ç½®ç³»ç»Ÿè·¯å¾„ï¼Œè¿™æ ·cmdå¯ä»¥å®ç°ä¸åœ¨Redisç›®å½•ä¸‹ï¼Œå¯åŠ¨RedisæœåŠ¡ï¼Œç„¶åå†å°†RedisæœåŠ¡æ³¨å†Œä¸ºwindowsçš„ç³»ç»ŸæœåŠ¡å³å¯ä½¿ç”¨ã€‚

### 3. Redisçš„åŸç†

### 1. åŸç†å›¾

Redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨0å·åº“ï¼Œç¼–å·æ˜¯0...15ï¼Œå¯ä»¥ä½¿ç”¨selectå…³é”®å­—åˆ‡æ¢æ•°æ®åº“ç¼–å·ï¼Œä½†æ˜¯æ¯ä¸ªæ•°æ®çš„æ•°æ®äº’ä¸å½±å“ã€‚

![image-20211129232657504](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211129232657504.png)

### 2. Redisäº”å¤§æ•°æ®ç±»å‹

Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Hashï¼ˆå“ˆå¸Œï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€zsetï¼ˆsorted setï¼šæœ‰åºé›†åˆï¼‰ã€‚

## äºŒã€Redisçš„åŸºæœ¬ä½¿ç”¨

### 1. åŸç”ŸRediså‘½ä»¤ä½¿ç”¨è¯¦è§£

#### â‘ String

- stringä»‹ç»

  stringæ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚é™¤æ™®é€šå­—ç¬¦å¤–ï¼Œä¹Ÿå¯ä»¥å­˜æ”¾å›¾ç‰‡ç­‰æ•°æ®ã€‚Redisé‡Œå­—ç¬¦ä¸²valueæœ€å¤§æ—¶512M

- string-crud

  - set[å¦‚æœå­˜åœ¨å°±ç›¸å½“äºä¿®æ”¹ï¼Œä¸å­˜åœ¨å°±å°±æ˜¯æ·»åŠ ]/get/del

  - mset[åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªkey-valueå¯¹]

  - mget[åŒæ—¶è·å–å¤šä¸ªkey-value]

  - æ¼”ç¤º

    ![image-20211203204256060](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203204256060.png)
  
    ![image-20211203204308118](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203204308118.png)
  
    ![image-20211203204324418](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203204324418.png)
  
    ![image-20211203204333875](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203204333875.png)

#### â‘¡Hash

- Hashçš„åŸºæœ¬ä»‹ç»

  Redis Hash æ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼ŒHashç‰¹åˆ«é€‚åˆå‚¨å­˜**å¯¹è±¡**ã€‚ 

- Hash-crud

  - hset/hget/hgetall/hdel
  
  - hmset/hmget/hlen[ç»Ÿè®¡hashæœ‰å¤šå°‘ä¸ªå…ƒç´ ]/hexists key feild[æŸ¥çœ‹å“ˆå¸Œè¡¨keyé‡Œï¼Œå®šåŸŸfieldæ˜¯å¦å­˜åœ¨]
  
  - æ¼”ç¤º
  
    ![image-20211203204111212](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203204111212.png)
  
    ![image-20211203204140139](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203204140139.png)
  
    ![image-20211203204151920](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203204151920.png)

#### â‘¢List

- ListåŸºæœ¬ä»‹ç»

  åˆ—è¡¨æ˜¯æœ€ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚å¯ä»¥åœ¨å¤´éƒ¨æˆ–å°¾éƒ¨æ·»åŠ å…ƒç´ ã€‚

  Listæœ¬è´¨æ˜¯ä¸ªé“¾è¡¨ï¼Œæ˜¯æœ‰åºçš„ï¼Œå…ƒç´ çš„å€¼å¯ä»¥é‡å¤ã€‚

  å¦‚æœListæ•°æ®å…¨ç§»é™¤ï¼Œå¯¹åº”çš„é”®ä¹Ÿä¼šæ¶ˆå¤±ï¼Œæˆ–è€…ç›´æ¥åˆ é™¤åˆ—è¡¨å

- List-crud

  - lpush/rpush/lrange/lpop/rpop/del/llen key
  
    lpushï¼šè¡¨ç¤ºä»åˆ—è¡¨å¤´éƒ¨ä¾æ¬¡æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ 
  
    rpushï¼šè¡¨ç¤ºä»åˆ—è¡¨å°¾éƒ¨ä¾æ¬¡ä¸€ä¸ªæˆ–å¤šä¸ªæ·»åŠ å…ƒç´ 
  
    lrangeï¼šè¡¨ç¤ºéå†åˆ—è¡¨ï¼Œindexä»0å¼€å§‹ï¼Œ-1è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨...
  
    lpopï¼šä»å·¦è¾¹å–å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä»åˆ—è¡¨åˆ é™¤
  
    rpopï¼šä»å³è¾¹å–å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä»åˆ—è¡¨åˆ é™¤
  
    delï¼šåˆ é™¤
  
  - æ¼”ç¤º
  
    ![image-20211203203808401](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203203808401.png)
  
    ![image-20211203201544298](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203201544298.png)
  
    ![image-20211203203828429](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203203828429.png)

#### â‘£Set

- SetåŸºæœ¬ä»‹ç»

  - Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚
  - åº•å±‚æ˜¯HashTableæ•°æ®ç»“æ„ï¼ŒSetå­˜æ”¾å¾ˆå¤šå­—ç¬¦ä¸²å…ƒç´ ï¼Œå¹¶ä¸”æ˜¯æ— åºçš„ï¼Œä¸èƒ½æœ‰é‡å¤

- Set-crud

  - sadd/smembers/sismember/srem[åˆ é™¤æŒ‡å®šå€¼]

  - æ¼”ç¤º

    ![image-20211203203736140](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203203736140.png)

    ![image-20211203203657097](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211203203657097.png)

[æ›´å¤šRediså‘½ä»¤](http://redisdoc.com/)

### 2. go-redisåº“ä½¿ç”¨

åŒºåˆ«äºå¦ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„Goè¯­è¨€redis clientåº“ï¼š`github.com/gomodule/redigo`ï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨`github.com/go-redis/redis`è¿æ¥Redisæ•°æ®åº“å¹¶è¿›è¡Œæ“ä½œï¼Œå› ä¸º`go-redis`æ”¯æŒè¿æ¥å“¨å…µåŠé›†ç¾¤æ¨¡å¼çš„Redisã€‚`go-redis`åº“æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨goè¯­è¨€å¯¹rediså‘½ä»¤è¿›è¡Œå°è£…æˆä¸€äº›æ–¹æ³•ï¼Œapiï¼Œæ–¹ä¾¿ç¨‹åºå‘˜æ“ä½œredisæ•°æ®åº“ã€‚

#### â‘ goè¿æ¥Redis

æ³¨ï¼šgo-redisæ”¯æŒæ™®é€šæ¨¡å¼ã€*<u>å“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼</u>*

```go
//initRedisClient åˆå§‹åŒ–redisè¿æ¥
func initRedisClient() (err error) {
	rds = redis.NewClient(&redis.Options{
		DB:       0,//é€‰æ‹©0-15å·redisæ•°æ®åº“ï¼Œ
		Addr:     "localhost:6379",//RedisæœåŠ¡ç›‘å¬çš„ç«¯å£å·
		Password: "",
	})
	result, err := rds.Ping().Result()
	if err != nil {
		return err
	}
	fmt.Println(result)
	return nil
}
```

#### â‘¡goæ“ä½œRedis

##### ï¼ˆ1ï¼‰crud

```go
//example1 æ¼”ç¤ºstringç±»å‹çš„set/getçš„ç”¨æ³•
func example1(addData interface{}) (err error) {
	err = rds.Set("score", addData, 0).Err()
	if err != nil {
		return err
	}
	result, err := rds.Get("score").Result()
	if err != nil {
		return err
	}
	fmt.Println("æ·»åŠ æ•°æ®ï¼š",result)
	return nil
}
//example2 æ¼”ç¤ºzsetï¼ˆæœ‰åºé›†åˆï¼‰çš„ç›¸å…³ç”¨æ³•
func example2() (err error) {
	//zsetçš„key
	zset:= "scoreRank"
	//ZAddæ·»åŠ å¤šä¸ªæ•°æ®
	scores := []redis.Z{
		redis.Z{
			Score: 91,
			Member: "åˆ˜æµ·æ–Œ",
		},
		redis.Z{
			Score: 99,
			Member: "åŒ…æ–‡æ°",
		},
		redis.Z{
			Score: 90,
			Member: "ç‹é“éœ–",
		},
		redis.Z{
			Score: 97,
			Member: "ç‰Ÿå›½æŸ±",
		},
	}
	fmt.Println(scores)
	result1, err := rds.ZAdd(zset, scores...).Result()
	if err != nil {
		fmt.Println(err)
		return err
	}
	fmt.Println("zaddï¼š",result1)
	//ä¿®æ”¹åˆ†æ•°,åœ¨åŸåœ°åˆ†æ•°åŸºç¡€ä¸Šæ·»åŠ 
	result2, err := rds.ZIncrBy(zset, 1, "åŒ…æ–‡æ°").Result()
	if err != nil {
		return err
	}
	fmt.Println("æˆåŠŸä¿®æ”¹ï¼š",result2)
	//å–åˆ†æ•°æœ€é«˜çš„ä¸‰ä¸ª
	result3, err := rds.ZRevRangeWithScores(zset,0,2).Result()
	if err != nil {
		return err
	}
	fmt.Println("åˆ†æ•°æœ€é«˜çš„ä¸‰ä¸ªï¼š",result3)
	//å–åˆ†æ•°æœ€ä½çš„ä¸‰ä¸ª
	result4, err := rds.ZRangeWithScores(zset,0,2).Result()
	if err != nil {
		return err
	}
	fmt.Println("åˆ†æ•°æœ€ä½çš„ä¸‰ä¸ªï¼š",result4)
	//å–95~100åˆ†çš„æ•°æ®
	zRangeBy := redis.ZRangeBy{
		Min: "95",
		Max: "100",
	}
	result5, err := rds.ZRangeByScoreWithScores(zset, zRangeBy).Result()
	if err != nil {
		return err
	}
	fmt.Println("95~100:ï¼š",result5)
	//rds.ZRevRangeByScore(zset,zRangeBy)
	return nil
}
```

##### ï¼ˆ2ï¼‰piplineç½‘ç»œä¼˜åŒ–

- go-redisåº“ä½¿ç”¨redisçš„è¿‡ç¨‹å›¾

  RTTè¡¨ç¤ºç½‘ç»œä¼ è¾“çš„æ—¶é—´+redisæœåŠ¡å™¨è§£æå¤„ç†çš„æ—¶é—´ã€‚ä¸¥æ ¼æ¥è¯´æœªç»ä¼˜åŒ–çš„rediså‘½ä»¤ï¼Œä¼šä¸€æ¡ä¸€æ¡çš„ä¼ è¾“rediså‘½ä»¤è‡³redisæœåŠ¡å™¨è¿›è¡Œè§£æï¼ŒæœŸé—´ç½‘ç»œå¾€è¿”æ—¶é—´èŠ±è´¹è¾ƒå¤šã€‚**æ³¨ï¼šredisæ˜¯å•çº¿ç¨‹çš„ï¼Œå› æ­¤æ¯æ¬¡åªèƒ½ä¼ è¾“ä¸€ä¸ªå‘½ä»¤è¿›è¡Œè§£æã€‚**

  ![image-20211204124642583](C:\Users\86157\AppData\Roaming\Typora\typora-user-images\image-20211204124642583.png)

- piplineç½‘ç»œä¼˜åŒ–æ€è·¯

  å®ƒæœ¬è´¨ä¸Šæ„å‘³ç€å®¢æˆ·ç«¯ç¼“å†²ä¸€å †å‘½ä»¤å¹¶ä¸€æ¬¡æ€§å°†å®ƒä»¬å‘é€åˆ°æœåŠ¡å™¨ã€‚è¿™äº›å‘½ä»¤ä¸èƒ½ä¿è¯åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯èŠ‚çœäº†æ¯ä¸ªå‘½ä»¤çš„ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰ã€‚

- piplineä¼˜åŒ–å®ä¾‹

  ```go
pipe := rdb.Pipeline()
  
  incr := pipe.Incr("pipeline_counter")
  pipe.Expire("pipeline_counter", time.Hour)
  
  _, err := pipe.Exec()
  fmt.Println(incr.Val(), err)
  ```
  
  ä¸Šé¢çš„ä»£ç ç›¸å½“äºå°†ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ä¸€æ¬¡å‘ç»™redis serverç«¯æ‰§è¡Œï¼Œä¸ä¸ä½¿ç”¨`Pipeline`ç›¸æ¯”èƒ½å‡å°‘ä¸€æ¬¡RTTã€‚

  ```bash
INCR pipeline_counter
  EXPIRE pipeline_counts 3600
  ```
  
  ä¹Ÿå¯ä»¥ä½¿ç”¨`Pipelined`ï¼š

  ```go
var incr *redis.IntCmd
  _, err := rdb.Pipelined(func(pipe redis.Pipeliner) error {
  	incr = pipe.Incr("pipelined_counter")
  	pipe.Expire("pipelined_counter", time.Hour)
  	return nil
  })
  fmt.Println(incr.Val(), err)
  ```
  
  åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå½“æˆ‘ä»¬æœ‰å¤šæ¡å‘½ä»¤è¦æ‰§è¡Œæ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨pipelineæ¥ä¼˜åŒ–ã€‚

- piplineç¼ºç‚¹

  piplineæ˜¯å°†å‘½ä»¤æ‰“åŒ…æˆä¸€ç»„ä¸€æ¬¡æ€§å‘é€æ‰§è¡Œï¼Œä¸é€‚åˆä¸¤ä¸ªå‘½ä»¤å…·æœ‰ä¾èµ–å…³ç³»çš„åœºæ™¯ã€‚

##### ï¼ˆ3ï¼‰äº‹åŠ¡

Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå› æ­¤å•ä¸ªå‘½ä»¤å§‹ç»ˆæ˜¯åŸå­çš„ï¼Œä½†æ˜¯æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„ä¸¤ä¸ªç»™å®šå‘½ä»¤å¯ä»¥ä¾æ¬¡æ‰§è¡Œï¼Œä¾‹å¦‚åœ¨å®ƒä»¬ä¹‹é—´äº¤æ›¿æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œ`Multi/exec`èƒ½å¤Ÿç¡®ä¿åœ¨`multi/exec`ä¸¤ä¸ªè¯­å¥ä¹‹é—´çš„å‘½ä»¤ä¹‹é—´æ²¡æœ‰å…¶ä»–å®¢æˆ·ç«¯æ­£åœ¨æ‰§è¡Œå‘½ä»¤ã€‚

åœ¨è¿™ç§åœºæ™¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨`TxPipeline`ã€‚`TxPipeline`æ€»ä½“ä¸Šç±»ä¼¼äºä¸Šé¢çš„`Pipeline`ï¼Œä½†æ˜¯å®ƒå†…éƒ¨ä¼šä½¿ç”¨`MULTI/EXEC`åŒ…è£¹æ’é˜Ÿçš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š

```go
pipe := rdb.TxPipeline()

incr := pipe.Incr("tx_pipeline_counter")
pipe.Expire("tx_pipeline_counter", time.Hour)

_, err := pipe.Exec()
fmt.Println(incr.Val(), err)
```

ä¸Šé¢ä»£ç ç›¸å½“äºåœ¨ä¸€ä¸ªRTTä¸‹æ‰§è¡Œäº†ä¸‹é¢çš„rediså‘½ä»¤ï¼š

```bash
MULTI
INCR pipeline_counter
EXPIRE pipeline_counts 3600
EXEC
```

è¿˜æœ‰ä¸€ä¸ªä¸ä¸Šæ–‡ç±»ä¼¼çš„`TxPipelined`æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

```go
var incr *redis.IntCmd
_, err := rdb.TxPipelined(func(pipe redis.Pipeliner) error {
	incr = pipe.Incr("tx_pipelined_counter")
	pipe.Expire("tx_pipelined_counter", time.Hour)
	return nil
})
fmt.Println(incr.Val(), err)
```

##### ï¼ˆ4ï¼‰Watch

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é™¤äº†è¦ä½¿ç”¨`MULTI/EXEC`å‘½ä»¤å¤–ï¼Œè¿˜éœ€è¦é…åˆä½¿ç”¨`WATCH`å‘½ä»¤ã€‚åœ¨ç”¨æˆ·ä½¿ç”¨`WATCH`å‘½ä»¤ç›‘è§†æŸä¸ªé”®ä¹‹åï¼Œç›´åˆ°è¯¥ç”¨æˆ·æ‰§è¡Œ`EXEC`å‘½ä»¤çš„è¿™æ®µæ—¶é—´é‡Œï¼Œå¦‚æœæœ‰å…¶ä»–ç”¨æˆ·æŠ¢å…ˆå¯¹è¢«ç›‘è§†çš„é”®è¿›è¡Œäº†æ›¿æ¢ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œé‚£ä¹ˆå½“ç”¨æˆ·å°è¯•æ‰§è¡Œ`EXEC`çš„æ—¶å€™ï¼Œäº‹åŠ¡å°†å¤±è´¥å¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è¿™ä¸ªé”™è¯¯é€‰æ‹©é‡è¯•äº‹åŠ¡æˆ–è€…æ”¾å¼ƒäº‹åŠ¡ã€‚

```go
Watch(fn func(*Tx) error, keys ...string) error
```

Watchæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªæˆ–å¤šä¸ªkeyä½œä¸ºå‚æ•°ã€‚åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š

```go
// ç›‘è§†watch_countçš„å€¼ï¼Œå¹¶åœ¨å€¼ä¸å˜çš„å‰æä¸‹å°†å…¶å€¼+1
key := "watch_count"
err = client.Watch(func(tx *redis.Tx) error {
	n, err := tx.Get(key).Int()
	if err != nil && err != redis.Nil {
		return err
	}
	_, err = tx.Pipelined(func(pipe redis.Pipeliner) error {
		pipe.Set(key, n+1, 0)
		return nil
	})
	return err
}, key)
```

æœ€åçœ‹ä¸€ä¸ªV8ç‰ˆæœ¬å®˜æ–¹æ–‡æ¡£ä¸­ä½¿ç”¨GETå’ŒSETå‘½ä»¤ä»¥äº‹åŠ¡æ–¹å¼é€’å¢Keyçš„å€¼çš„ç¤ºä¾‹ï¼Œä»…å½“Keyçš„å€¼ä¸å‘ç”Ÿå˜åŒ–æ—¶æäº¤ä¸€ä¸ªäº‹åŠ¡ã€‚

```go
func transactionDemo() {
	var (
		maxRetries   = 1000
		routineCount = 10
	)
	ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
	defer cancel()

	// Increment ä½¿ç”¨GETå’ŒSETå‘½ä»¤ä»¥äº‹åŠ¡æ–¹å¼é€’å¢Keyçš„å€¼
	increment := func(key string) error {
		// äº‹åŠ¡å‡½æ•°
		txf := func(tx *redis.Tx) error {
			// è·å¾—keyçš„å½“å‰å€¼æˆ–é›¶å€¼
			n, err := tx.Get(ctx, key).Int()
			if err != nil && err != redis.Nil {
				return err
			}

			// å®é™…çš„æ“ä½œä»£ç ï¼ˆä¹è§‚é”å®šä¸­çš„æœ¬åœ°æ“ä½œï¼‰
			n++

			// æ“ä½œä»…åœ¨ Watch çš„ Key æ²¡å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹æäº¤
			_, err = tx.TxPipelined(ctx, func(pipe redis.Pipeliner) error {
				pipe.Set(ctx, key, n, 0)
				return nil
			})
			return err
		}

		// æœ€å¤šé‡è¯• maxRetries æ¬¡
		for i := 0; i < maxRetries; i++ {
			err := rdb.Watch(ctx, txf, key)
			if err == nil {
				// æˆåŠŸ
				return nil
			}
			if err == redis.TxFailedErr {
				// ä¹è§‚é”ä¸¢å¤± é‡è¯•
				continue
			}
			// è¿”å›å…¶ä»–çš„é”™è¯¯
			return err
		}

		return errors.New("increment reached maximum number of retries")
	}

	// æ¨¡æ‹Ÿ routineCount ä¸ªå¹¶å‘åŒæ—¶å»ä¿®æ”¹ counter3 çš„å€¼
	var wg sync.WaitGroup
	wg.Add(routineCount)
	for i := 0; i < routineCount; i++ {
		go func() {
			defer wg.Done()
			if err := increment("counter3"); err != nil {
				fmt.Println("increment error:", err)
			}
		}()
	}
	wg.Wait()

	n, err := rdb.Get(context.TODO(), "counter3").Int()
	fmt.Println("ended with", n, err)
}
```

æ›´å¤šè¯¦æƒ…è¯·æŸ¥é˜…[æ–‡æ¡£](https://pkg.go.dev/github.com/go-redis/redis)ã€‚

## ä¸‰ã€redisåŸç”Ÿå‘½ä»¤è¯¦è§£

å‰æå¼•å…¥

åœ¨äº†è§£redisä¹‹å‰æˆ‘ä»¬éœ€è¦ç®€è¦çŸ¥é“ä¸€ä¸ªæ¦‚å¿µï¼Œä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œä»€ä¹ˆæ˜¯éå…³ç³»å‹æ•°æ®åº“ã€‚

- NoSQL:æœ€å¸¸è§çš„è§£é‡Šæ˜¯â€œnon-relationalâ€ï¼Œ"Not Only SQL"ä¹Ÿè¢«è®¸å¤šäººæ¥å—ï¼ŒNoSQLä¹Ÿä»…ä»…æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“ï¼Œä¹ŸåŒºåˆ«äºå…³ç³»å‹æ•°æ®åº“ã€‚ä»–ä»¬å¹¶ä¸ä¼šä¿è¯å…³ç³»æ•°æ®çš„**ACID**ç‰¹æ€§ã€‚NoSQLæ˜¯ä¸€é¡¹å…¨æ–°çš„æ•°æ®åº“é©å‘½æ€§è¿åŠ¨ï¼Œå…¶æ‹¥æŠ¤è€…ä»¬æå€¡è¿ç”¨éå…³ç³»å‹çš„æ•°æ®å­˜å‚¨ã€‚

**å…³ç³»å‹æ•°æ®åº“**ï¼šå…³ç³»å‹æ•°æ®åº“æœ€å…¸å‹çš„**æ•°æ®ç»“æ„æ˜¯è¡¨**ï¼Œç”±**äºŒç»´è¡¨**åŠå…¶**ä¹‹é—´çš„è”ç³»**æ‰€ç»„æˆçš„ä¸€ä¸ªæ•°æ®ç»„ç»‡ã€‚åœ¨æ•°æ®åº“ä¸­æœ‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µ,**å…³ç³»è¦æ¯”è¡¨ç»“æ„é‡è¦**

**éå…³ç³»å‹æ•°æ®åº“**ï¼š**æ˜¯ä¸€ç§æ•°æ®ç»“æ„åŒ–å­˜å‚¨æ–¹æ³•çš„é›†åˆï¼Œå¯ä»¥æ˜¯æ–‡æ¡£æˆ–è€…é”®å€¼å¯¹ç­‰**ï¼Œéå…³ç³»å‹æ•°æ®åº“æå‡ºå¦ä¸€ç§ç†å¿µï¼Œä¾‹å¦‚ï¼Œä»¥é”®å€¼å¯¹å­˜å‚¨ï¼Œä¸”ç»“æ„ä¸å›ºå®šï¼Œæ¯ä¸€ä¸ªå…ƒç»„å¯ä»¥æœ‰ä¸ä¸€æ ·çš„å­—æ®µï¼Œæ¯ä¸ªå…ƒç»„å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ ä¸€äº›è‡ªå·±çš„é”®å€¼å¯¹ï¼Œè¿™ æ ·å°±ä¸ä¼šå±€é™äºå›ºå®šçš„ç»“æ„ï¼Œå¯ä»¥å‡å°‘ä¸€äº›æ—¶é—´å’Œç©ºé—´çš„å¼€é”€ã€‚æ–‡æ¡£å‹æ•°æ®åº“ã€‚

## ä»€ä¹ˆæ˜¯redisï¼Ÿ

Redisæ˜¯ç°åœ¨æœ€å—æ¬¢è¿çš„NoSQLæ•°æ®åº“ä¹‹ä¸€ï¼ŒRedisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€åŒ…å«å¤šç§æ•°æ®ç»“æ„ã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ï¼Œå…¶å…·å¤‡å¦‚ä¸‹ç‰¹æ€§ï¼š

- åŸºäºå†…å­˜è¿è¡Œï¼Œæ€§èƒ½é«˜æ•ˆ

- æ”¯æŒåˆ†å¸ƒå¼ï¼Œç†è®ºä¸Šå¯ä»¥æ— é™æ‰©å±•

- key-valueå­˜å‚¨ç³»ç»Ÿ

- å¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€éµå®ˆBSDåè®®ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„API

**å¸¸è§çš„ä½¿åœºæ™¯**

1.ç¼“å­˜ç³»ç»Ÿï¼ˆçƒ­ç‚¹æ•°æ®ï¼šé«˜é¢‘è¯»å–ï¼Œä½é¢‘å†™ï¼‰

- ç”±äºredisè®¿é—®é€Ÿåº¦å—ã€æ”¯æŒçš„æ•°æ®ç±»å‹æ¯”è¾ƒä¸°å¯Œï¼Œæ‰€ä»¥rediså¾ˆé€‚åˆç”¨æ¥å­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼Œå¦å¤–ç»“åˆexpireï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ç„¶åå†è¿›è¡Œç¼“å­˜æ›´æ–°æ“ä½œï¼Œè¿™ä¸ªåŠŸèƒ½æœ€ä¸ºå¸¸è§

2.æ’è¡Œæ¦œ

- å…³ç³»å‹æ•°æ®åº“åœ¨æ’è¡Œæ¦œæ–¹é¢æŸ¥è¯¢é€Ÿåº¦æ™®éåæ…¢ï¼Œæ‰€ä»¥å¯ä»¥å€ŸåŠ©redisçš„SortedSetè¿›è¡Œçƒ­ç‚¹æ•°æ®çš„æ’åºã€‚

3.MQï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰

- ç”±äºredisæœ‰list pushå’Œlist popè¿™æ ·çš„å‘½ä»¤ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„æ‰§è¡Œé˜Ÿåˆ—æ“ä½œã€‚

ç•¥ã€‚ã€‚ä½¿ç”¨åœºæ™¯å¤ªå¤šäº†ï¼Œè¿˜æœ‰ä»€ä¹ˆå‘å¸ƒè®¢é˜…å•¥çš„ï¼Œå¥½å‹å…³ç³»å‚¨å­˜å•¥çš„

## redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ

**é¦–å…ˆï¼Œé‡‡ç”¨äº†å¤šè·¯å¤ç”¨ioé˜»å¡æœºåˆ¶**
**ç„¶åï¼Œæ•°æ®ç»“æ„ç®€å•ï¼Œæ“ä½œèŠ‚çœæ—¶é—´**
**æœ€åï¼Œè¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œè‡ªç„¶é€Ÿåº¦å¿«**

æé—®ï¼šæœ‰äººçŸ¥é“IOé˜»å¡æœºåˆ¶å—ï¼Ÿ

## redisçš„åŸºæœ¬å‘½ä»¤

### å­—ç¬¦ä¸²

#### SET

è¯­æ³•

```
SET key value [EX seconds] [PX milliseconds] [NX|XX]
```

è¿™é‡Œå°±æ˜¯ä¸€ç»„å…¸å‹çš„é”®å€¼å¯¹

**EX_seconds**:è¡¨æ˜è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ˜¯ç§’

**PX**:å•ä½æ¯«ç§’

**NX** ï¼š åªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œ æ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œ

**XX**ï¼š ä¸NXç›¸ååªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œ æ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œ

åŸºæœ¬æ“ä½œï¼Œæ³¨æ„å½“é”®å€¼å¯¹å·²ç»å­˜åœ¨æ—¶å€™ï¼Œä¼šæ›¿æ¢æ‰å…¶å¯¹åº”çš„value

```plain
127.0.0.1:6379> SET key "value"
OK
127.0.0.1:6379> get key
"value"
```

ä½¿ç”¨EXã€PXé€‰é¡¹,TTL å‘½ä»¤æ˜¾ç¤ºè¿‡æœŸæ—¶é—´s(PTTLæ˜¾ç¤ºms)ï¼Œè¿™é‡Œæ— æ³•åŒæ—¶ä½¿ç”¨EX,PXé€‰é¡¹

```plain
127.0.0.1:6379> SET key "hello" EX 1000
OK
127.0.0.1:6379> TTL key
(integer) 992
127.0.0.1:6379> get key
"hello"
```

ä½¿ç”¨äº†XXä¸NXé€‰é¡¹ï¼ŒNXå°±æ˜¯å½“è¿™ä¸ªkvä¸å­˜åœ¨çš„æ—¶å€™æ‰ä¼šè¢«è®¾ç½® ,XXç¡®å®åœ¨è¿™ä¸ªkvå­˜åœ¨çš„æ—¶å€™æ‰ä¼šè¢«è®¾ç½®

```plain
127.0.0.1:6379> SET key "test" NX
(nil)
127.0.0.1:6379> GET key
"hello"

127.0.0.1:6379> SET AAA "SSS" XX
(nil)
```

#### MSET

è¯­æ³•ï¼š`MEST k1 v1 k2 v2`

åŒæ—¶è®¾ç½®å¤šä¸ªé”®å€¼å¯¹ï¼Œå¹¶ä¸”æ€»æ˜¯è¿”å›OKï¼Œï¼ˆæœ‰MSETå°±è‚¯å®šä¼šæœ‰MGETæ¥å¾—åˆ°å¤šä¸ªå€¼ï¼‰

```plain
127.0.0.1:6379> MSET k1 v1 k2 v2
OK
127.0.0.1:6379> MGET k1 k2
1) "v1"
2) "v2"
```

#### **SETNX**

SETNXï¼ˆset if not existsï¼‰è·Ÿä¸Šè¿°åŠ ä¸ŠNXé€‰é¡¹çš„SETåŠŸèƒ½ä¸€æ ·

```plain
127.0.0.1:6379> SETNX key3 "value"
(integer) 1
127.0.0.1:6379> exists key3
(integer) 1
127.0.0.1:6379> SETNX key3 "worry"
(integer) 0
127.0.0.1:6379> GET key3
"value"
```

#### SETEX

è¯­æ³•:`SETEX key seconds value`

å…ˆè·Ÿæ—¶é—´å†è·Ÿå€¼

```plain
127.0.0.1:6379> SETEX id 60 12318
OK
127.0.0.1:6379> TTL id
(integer) 46
127.0.0.1:6379> GET id
"12318"
```

#### PSETEX

è·ŸSETEXå·®ä¸è¿‡ï¼Œåªä¸è¿‡è¿™ä¸ªæ˜¯ä»¥msä¸ºå•ä½äº†

#### GET

è¯­æ³•ï¼š`GET key`

è¿”å›å€¼ï¼šè‹¥valueå­˜åœ¨ï¼Œåˆ™è¿”å›valueï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›nilï¼Œè‹¥è¯¥é”®å¯¹åº”çš„å€¼ä¸ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œåˆ™è¿”å›é”™è¯¯

#### DEL

åˆ é™¤

è¿”å›å€¼ï¼šè¿”å›åˆ é™¤çš„keyæ•°é‡

```plain
127.0.0.1:6379> DEL k1
(integer) 1
```

#### GETSET

è¯­æ³•ï¼šGETSET key value

è®¾ç½®å½“å‰çš„key-valueï¼Œå¹¶è¿”å›ä¹‹å‰çš„å€¼ï¼Œå¦‚æœä¹‹å‰çš„keyå¹¶ä¸å­˜åœ¨ï¼Œå°±è¿”å›nil

è¿™é‡Œå¦‚æœåŸæ¥å°±ä¸å­˜åœ¨è¿™ä¸ªKVï¼Œåˆ™ä¼šè¿”å›nil

```plain
127.0.0.1:6379> GETSET k2 "value"
"v2"
127.0.0.1:6379> GET k2
"value"
```

#### STRLEN

è¯­æ³•ï¼š`STRLEN key`

è·Ÿä¸Šè¿°çš„SETè¯­æ³•ç±»ä¼¼ï¼Œåªæ˜¯`STRLEN` å‘½ä»¤è¿”å›å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚

å½“é”® `key` ä¸å­˜åœ¨æ—¶ï¼Œ å‘½ä»¤è¿”å› `0` ã€‚

å½“ `key` å‚¨å­˜çš„ä¸æ˜¯å­—ç¬¦ä¸²å€¼æ—¶ï¼Œ è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

```plain
127.0.0.1:6379> GET k2
"value"
127.0.0.1:6379> STRLEN k2
(integer) 5
```

#### APPEND

è¯­æ³•ï¼š`APPEND key value`

è¿½åŠ å­—ç¬¦ä¸²ï¼Œè‹¥è¯¥keyå·²å­˜åœ¨ï¼Œåˆ™å¾€åè¿½åŠ ï¼Œè‹¥ä¸å­˜åœ¨å°±è·Ÿç®€å•çš„æ‰§è¡Œ`SET`ä¸€æ ·

è¿”å›è¿½åŠ åkeyçš„é•¿åº¦

```plain
127.0.0.1:6379> GET k2
"value"
127.0.0.1:6379> APPEND k2 "is good"
(integer) 12
127.0.0.1:6379> get k2
"valueis good"
```

#### SETRANGE

è¯­æ³•ï¼š`SETRANGE key offset value`

ä»åç§»é‡`offset`åè¦†ç›–åŸæ¥çš„valueï¼Œå¹¶è¿”å›å½“å‰keyå¯¹åº”å­—ç¬¦ä¸²çš„é•¿åº¦

```plain
127.0.0.1:6379> SETRANGE k2 8 "golang"
(integer) 14
127.0.0.1:6379> GET k2
"valueis golang"
```

#### GETRANGE

è¯­æ³•ï¼š`GETRANGE key start end`

è·å–[start,end]çš„å­å­—ç¬¦ä¸²ï¼Œå…è®¸è´Ÿåç§»é‡ï¼Œå³-1ä»£è¡¨æœ€åä¸€ä¸ªï¼Œ-2ä»£è¡¨å€’æ•°ç¬¬äºŒä¸ª

æ•°å­—è§„åˆ™å’Œå‰é¢ä¸€æ ·

```plain
127.0.0.1:6379> GETRANGE k2 0 -1
"valueis golang"
```

#### INCR

è¯­æ³•ï¼šINCR key

ä¸ºé”® `key` å‚¨å­˜çš„æ•°å­—å€¼åŠ ä¸Šä¸€ã€‚

å¦‚æœé”® `key` ä¸å­˜åœ¨ï¼Œ é‚£ä¹ˆå®ƒçš„å€¼ä¼šå…ˆè¢«åˆå§‹åŒ–ä¸º `0` ï¼Œ ç„¶åå†æ‰§è¡Œ `INCR` å‘½ä»¤ã€‚

å¦‚æœé”® `key` å‚¨å­˜çš„å€¼ä¸èƒ½è¢«**è§£é‡Š**ä¸ºæ•°å­—ï¼ˆå› ä¸ºredisä¸­å¹¶æ²¡æœ‰ä¸“ç”¨çš„æ•´æ•°ç±»å‹ï¼‰ï¼Œ é‚£ä¹ˆ `INCR` å‘½ä»¤å°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

```plain
127.0.0.1:6379> SET n 1
OK
127.0.0.1:6379> GET n
"1"
127.0.0.1:6379> INCR n
(integer) 2
127.0.0.1:6379> get n
"2"
```

### å“ˆå¸Œ

#### HSET

è¯­æ³•ï¼š`HEST hash field value`

å°†hashè¡¨ä¸­fieldåŸŸè®¾ç½®ä¸ºvalueï¼Œä¸ä¹‹ç›¸é…çš„ä¸ºHGET(`HEGT hash field`)

è¿”å›å€¼ï¼šå½“ `HSET` å‘½ä»¤åœ¨å“ˆå¸Œè¡¨ä¸­æ–°åˆ›å»º `field` åŸŸå¹¶æˆåŠŸä¸ºå®ƒè®¾ç½®å€¼æ—¶ï¼Œ å‘½ä»¤è¿”å› `1` ï¼› å¦‚æœå·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå‘½ä»¤è¿”å› `0` ã€‚

å¦‚ï¼š

```plain
127.0.0.1:6379> HSET map k1 v1
(integer) 1
127.0.0.1:6379> HGET map k1
"v1"
```

#### HLEN

è¯­æ³•ï¼š`HLEN hash`

è¿”å›å“ˆå¸Œè¡¨hashä¸­åŸŸçš„æ•°é‡ï¼Œè‹¥hashä¸å­˜åœ¨ï¼Œåˆ™è¿”å›0

å¦‚ï¼š

```plain
127.0.0.1:6379> HLEN map
(integer) 1
```

#### HDEL

è¯­æ³•ï¼š`HDEL key field1 field2...`

åˆ é™¤å“ˆå¸Œè¡¨keyä¸­çš„åŸŸï¼Œå¹¶è¿”å›æˆåŠŸåˆ é™¤çš„åŸŸçš„æ•°é‡

å¦‚ï¼š

```plain
127.0.0.1:6379> HDEL map k1
(integer) 1
127.0.0.1:6379> hgetall map
(empty list or set)
```

å…¶ä»–çš„å“ˆå¸Œæ“ä½œä½ ä»¬è‡ªå·±å»è¯•è¯•å§ã€‚

### é˜Ÿåˆ—

#### LPUSHä¸LRANGE

å°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªå€¼æ’å…¥**åˆ—è¡¨å¤´éƒ¨**ï¼Œå¦‚æœä¸ºç©ºåˆ—è¡¨ä¼šè¢«åˆ›å»ºæ‰§è¡ŒLPUSHï¼Œå½“keyå­˜åœ¨ä½†æ˜¯å´ä¸æ˜¯åˆ—è¡¨ï¼Œå°±è¿”å›é”™è¯¯

LRANGEè¿™å‘½ä»¤ä¸­0æ ‡è¯†åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ1åˆ™æ˜¯ç¬¬äºŒä¸ªã€‚

-1ä»£è¡¨æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2åˆ™ä»£è¡¨å€’æ•°ç¬¬äºŒä¸ªã€‚

```plain
127.0.0.1:6379> LPUSH list java c++ go
(integer) 3
127.0.0.1:6379> LRANGE list 0 -1
1) "go"
2) "c++"
3) "java"
```

#### LPOP

è¯­æ³•ï¼š`LPOP key`

ç§»é™¤åˆ—è¡¨keyçš„è¡¨å¤´å…ƒç´ ï¼Œå³å‡ºé˜Ÿåˆ—

```plain
127.0.0.1:6379> LPOP list
"go"
127.0.0.1:6379> LRANGE list 0 -1
1) "c++"
2) "java"
```

#### LSET

è¯­æ³•ï¼š`LSET key index value`

å°†åˆ—è¡¨ keyä¸‹æ ‡ä¸º index çš„å…ƒç´ çš„å€¼è®¾ç½®ä¸º value

è‹¥ `index` (è¿™é‡Œçš„ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼Œä¹Ÿå…è®¸è´Ÿæ•°)å‚æ•°è¶…å‡ºèŒƒå›´ï¼Œæˆ–å¯¹ä¸€ä¸ªç©ºåˆ—è¡¨( `key` ä¸å­˜åœ¨)è¿›è¡Œæ“ä½œæ—¶ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼ŒæˆåŠŸè¿”å›OK

```plain
127.0.0.1:6379> LSET list 1 "go"
OK
127.0.0.1:6379> LRANGE list 0 -1
1) "c++"
2) "go"
```

å…¶ä»–é˜Ÿåˆ—æ“ä½œè‡ªå·±å»è¯•è¯•å§

### é›†åˆ

#### SADD

è¯­æ³•ï¼š`SADD key m1 m2...`

å°†ä¸€ä¸ªæˆ–å¤šä¸ª `member` å…ƒç´ åŠ å…¥åˆ°é›†åˆ `key` å½“ä¸­ï¼Œå·²ç»å­˜åœ¨äºé›†åˆçš„ `member` å…ƒç´ å°†è¢«å¿½ç•¥ï¼ˆè€Œåˆ—è¡¨åˆ™ä¸ä¼šå¿½ç•¥ï¼‰ã€‚å¹¶è¿”å›æˆåŠŸæ·»åŠ åˆ°é›†åˆçš„æ•°ç›®

ä¸ä¹‹å¯¹åº”çš„SMEMBERSï¼ˆ`SMEMBERS key`ï¼‰åˆ™æ˜¯è·å–è¯¥é›†åˆ

å¦‚ï¼š

```plain
127.0.0.1:6379> SADD arr m1 m2 m2
(integer) 2
127.0.0.1:6379> SMEMBERS arr
1) "m2"
2) "m1"
```

#### SPOP

è¯­æ³•ï¼š`SPOP key`

ç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ª**éšæœº**å…ƒç´ ,å¹¶è¿”å›è¢«ç§»é™¤çš„å…ƒç´ ï¼Œè‹¥keyä¸å­˜åœ¨æˆ–è¯¥é›†åˆä¸ºç©ºæ—¶ï¼Œå°±è¿”å›nil

```plain
127.0.0.1:6379> SPOP arr
"m1"
```

#### SMOVE

è¯­æ³•ï¼š`SMOVE source destination member`

å¦‚æœ `source` é›†åˆä¸å­˜åœ¨æˆ–ä¸åŒ…å«æŒ‡å®šçš„ `member` å…ƒç´ ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä»…è¿”å› `0` ã€‚å¦åˆ™ï¼Œ `member` å…ƒç´ ä» `source` é›†åˆä¸­è¢«**ç§»é™¤**ï¼Œå¹¶**æ·»åŠ **åˆ° `destination` é›†åˆä¸­å»ã€‚

å½“ `destination` é›†åˆå·²ç»åŒ…å« `member` å…ƒç´ æ—¶ï¼Œè¯¥å‘½ä»¤åªæ˜¯ç®€å•åœ°å°† `source` é›†åˆä¸­çš„ `member` å…ƒç´ åˆ é™¤ã€‚

å¦‚ï¼š

```plain
127.0.0.1:6379> SADD k1 m1 m2
(integer) 2
127.0.0.1:6379> SADD k3 m3
(integer) 1
127.0.0.1:6379> SMOVE k1 k3 m1
(integer) 1
127.0.0.1:6379> smembers k1
1) "m2"
127.0.0.1:6379> smembers k3
1) "m3"
2) "m1"
```

### æœ‰åºé›†åˆ

#### ZADD

è¯­æ³•ï¼š`ZADD key score1 member1 score2 member2â€¦`

å°†ä¸€ä¸ªæˆ–å¤šä¸ª `member` å…ƒç´ åŠå…¶ `score` å€¼åŠ å…¥åˆ°æœ‰åºé›† `key` å½“ä¸­ï¼Œæ³¨æ„è¿™é‡Œçš„memberå’Œscoreæ˜¯å¿…é¡»é…å¯¹çš„ï¼Œè€Œä¸”scoreå¿…é¡»æ˜¯æµ®ç‚¹æ•°æˆ–è€…æ•´å‹ï¼Œæ·»åŠ æˆåŠŸåè¿”å›è¢«æˆåŠŸæ·»åŠ çš„æ–°æˆå‘˜çš„æ•°é‡

å¦‚ï¼š

```plain
127.0.0.1:6379> ZADD z 1 m1 2 m2
(integer) 2
127.0.0.1:6379> ZRANGE z 0 -1 WITHSCORES
1) "m1"
2) "1"
3) "m2"
4) "2"
127.0.0.1:6379> ZRANGE z 0 -1
1) "m1"
2) "m2"
127.0.0.1:6379> zrem z m1
(integer) 1
127.0.0.1:6379> ZRANGE z 0 -1
1) "m2"
```

#### ZRANGE

è¯­æ³•ï¼š`ZRANGE key start stop [WITHSCORES]`

è¿”å›æœ‰åºé›† `key` ä¸­ï¼Œå¹¶ä¸”å…¶ä¸­æˆå‘˜çš„ä½ç½®æŒ‰ `score` å€¼é€’å¢(ä»å°åˆ°å¤§)æ¥æ’åºï¼ˆ`ZREVRANGE`åˆ™æŒ‰ä»å¤§åˆ°å°æ’åˆ—ï¼‰ã€‚

ä¾‹å­å¦‚ä¸Šï¼Œè¿™é‡Œä¾¿ä¸ä¸¾ä¾‹äº†

#### ZREM

è¯­æ³•:`ZREM key member1 member2`

ç§»é™¤æœ‰åºé›† `key` ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œä¸å­˜åœ¨çš„æˆå‘˜å°†è¢«å¿½ç•¥ï¼Œå¹¶è¿”å›æˆåŠŸç§»é™¤çš„æ•°é‡

ä¾‹å­å¦‚ä¸Šï¼Œè¿™é‡Œä¾¿ä¸ä¸¾ä¾‹äº†

### Redisäº‹åŠ¡

æˆ‘ä»¬å¼€å§‹ä¹Ÿè¯´äº†NOSQLæ˜¯ä¸ä¼šä¿è¯å…³ç³»æ•°æ®çš„ACIDçš„ï¼Œè¯¦è§

https://www.cnblogs.com/chenpingzhao/archive/2015/11/27/5001894.html

redisä¸­å¦‚ä½•æ‰§è¡Œäº‹åŠ¡ï¼Ÿ

åœ¨redisä¸­`multi`æ ‡å¿—ç€äº‹åŠ¡çš„å¼€å§‹ï¼Œ`exec`å³æ‰§è¡Œäº‹åŠ¡

```plain
127.0.0.1:6379> multi
OK
127.0.0.1:6379> set k1 v1
QUEUED
127.0.0.1:6379> set k2 v1
QUEUED
127.0.0.1:6379> exec
1) OK
2) OK
```

æ€è€ƒä¸€ä¸‹å“ªé‡Œæœ‰é—®é¢˜

```plain
127.0.0.1:6379> multi
OK
127.0.0.1:6379> set k1 v2
QUEUED
127.0.0.1:6379> lpush k2 v2
QUEUED
127.0.0.1:6379> exec
1) OK
2) (error) WRONGTYPE Operation against a key holding the wrong kind of value
127.0.0.1:6379> get k1
"v2"
```

å¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€æ¡æ‰§è¡ŒæˆåŠŸï¼Œè€Œç¬¬äºŒæ¡å¤±è´¥äº†ï¼Œè¿™å¹¶ä¸å¤åˆäº‹åŠ¡çš„åŸå­æ€§ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬çš„redisäº‹åŠ¡æ˜¯ä¸æ»¡è¶³å¹³æ—¶æ‰€è¯´çš„ACDIæ€§è´¨çš„ï¼Œå…¶æ²¡æœ‰å›æ»šçš„æœºåˆ¶ï¼ˆå³äº‹åŠ¡ä¸­çš„å‘½åæ‰§è¡Œé”™è¯¯ï¼Œå›æ»šåˆ°äº‹åŠ¡æ‰§è¡Œä¹‹å‰ï¼‰
